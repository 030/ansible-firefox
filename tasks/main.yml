---
- name: get latest version information json url
  uri:
    url: http://releasesoftwaremoreoften.com/latestversion?name=firefox
    return_content: yes
  register: firefox_latest_version_info_url

- name: set firefox latest version information
  set_fact: firefox_latest_version_info="{{ firefox_latest_version_info_url.content }}"

- name: set latest version
  set_fact: firefox_version_latest="{{ firefox_latest_version_info.latestVersion }}"

- name: set latest checksum
  set_fact: firefox_checksum_latest="{{ firefox_latest_version_info.checksum }}"

- name: Dependencies.
  package:
    name: "{{ item }}"
  with_items:
     - bzip2
     - gtk3
     - libXt

- name: Download.
  get_url:
    url: https://ftp.mozilla.org/pub/firefox/releases/{{ firefox_version }}/linux-x86_64/en-US/firefox-{{ firefox_version }}.tar.bz2
    dest: /tmp/firefox-{{ firefox_version }}.tar.bz2
    checksum: "{{ firefox_checksum }}"

- name: Directory.
  file:
    path: "{{ firefox_home }}"
    state: directory
    mode: 0755

- name: Unarchive.
  unarchive:
    src: "{{ firefox_download }}"
    dest: "{{ firefox_home }}"
    remote_src: yes
    creates: "{{ firefox_bin }}"

- name: Symlink.
  file:
    src: "{{ firefox_bin }}"
    dest: /usr/bin/firefox
    state: link
  notify:
    - Check version.

- name: Create desktop icon.
  copy:
    src: firefox.desktop
    dest: /usr/share/applications/firefox.desktop
    owner: root
    group: root
    mode: 0644
  when: firefox_desktop_icon
